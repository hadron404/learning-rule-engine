

业务规则管理系统（Business Rule Management System，BRMS）





规则引擎（Rule Engine）




元素

* Rule：规则，即是条件
* Fact：事实，存在某种东西是一种事实，不存在某种东西也是一种事实，规则引擎将现有的事实带入到规则中，如果满足执行则执行动作
* Action：动作，满足某种规则后需要执行的动作



![img](https://pic4.zhimg.com/v2-a7d7bcd2d4099737416831af1257f45f_r.jpg)

规则引擎由推理引擎发展而来，是一种嵌入在应用程序中的组件，实现了将业务决策从应用程序代码中分离出来，并使用预定义的语义模块编写业务决策。接受数据输入，解释业务规则，并根据规则做出业务决策。

规则引擎由基于规则的系统（Role-based Systems）发展而来的，是知识库（Knowledge-based）系统的一个分支，属于人工智能的范畴。

- 知识库（Knowledge Base）
- 工作内存（Working Memory）
- 推理引擎（Inference Engine）



知识库：用于知识管理的一种特殊的数据库，以便于有关领域知识的采集、整理以及提取。知识库中的知识源于领域专家，它是求解问题所需领域知识的集合，包括基本事实、规则和其他有关信息。



推理引擎由三部分组成

* 模式匹配器（Pattern Matcher）：从知识库中找出需要执行的规则并写入
* 议程（Agenda）：议程为这些规则赋予优先级，确定执行顺序
* 规则解释器（Rule Interprete）：执行这些规则并输出运行结果

推理引擎有两种推理方式

* 演绎：演绎法应用规则通过事实得出结论
* 归纳：根据定义的假设，查找符合该假设的事实



使用演绎法的推理引擎的推理步骤如下

1. 将初始数据输入到工作内存中
2. 使用模式匹配器将知识库中的规则和数据比较
3. 如果执行规则存在冲突，即同时激活了多个规则，将冲突的规则放入冲突集合
4. 解决冲突，将激活的规则按顺序放入议程
5. 执行议程中的规则
6. 重复步骤2-5，直到执行完毕议程中的所有规则，输出运行结果



业务规则的执行顺序是根据执行议程中的所有规则，当引擎执行规则时，由于工作内存的数据对象会因为规则的执行而发生改变。这样执行议程中的业务规则执行实例会发生动态的变化，可能增加也可能减少。于是就产生了一种

“动态”的规则执行链，形成所谓的规则的推理机制。



核心算法



RETE 算法：是 Charles Forgy 在1979年的论文中首次提出的，针对基于规则知识表现的模式匹配算法





## 规则引擎解决的核心问题

- 使用规则引擎可以把复杂、重复的业务规则同各个业务系统分离开，以提高业务逻辑的复用能力和开发变更效率，降低整体系统的耦合性
- 规则引擎通常需要较强的易用性，以便业务人员能够快速自测，并在不重新启动系统的情况下发布规则，以减少测试和发布的成本。
- 通过对决策结果的积累和回溯，可以反向推动规则的迭代优化，帮助组织形成一个不断演进的商业智能分析知识库。




应用场景

- 流程分支非常复杂，规则变量庞大，常规编码（if-else）难以实现
- 业务规则复杂，不确定性的需求，且经常变动有，变更频率较高
- 需要快速做出响应和决策
- 规则变更期望脱离于开发人员，脱离coding
- 无法直观表达现有业务逻辑，新人入手困难。
- 新增&改动逻辑困难，极难扩展；通用处理成本高。
- 每次变更逻辑时都需要经历一次完整的研发-测试-发布-回测-灰度，效率低成本高。


业务场景示例

* 风险控制系统--风险贷款、风险评估
* 反欺诈项目--银行贷款、征信验证
* 决策平台系统--财务计算
* 促销平台系统--满减、打折、加价购



促销业务场景

有一种我们生活中常见的业务场景，电商交易促销的销售方案（满减），这在上文也提到过，这种业务模型的特性有着固定的输入参数和输出格式，中间规则部分要求能够配置化，尽可能灵活。例如，在满减方案里，一般有规则规定满多少减多少，比如开始的规定是满200减50，如果商家临时改变促销方案，改成满200减80，此时只需要利用规则引擎改配置即可，不需要重新写代码。



如果应用的生命周期很短，没有必要使用规则引擎，使用规则引擎将会在中长期维护中得到好处。

[RulesEngine (martinfowler.com)](https://martinfowler.com/bliki/RulesEngine.html)

[新一代开源Java可视化规则引擎-ice介绍~_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1hg411A7jx/?vd_source=235d115343b150127fcf0c88cd78642c)

[规则引擎在促销管理系统中的研究及应用摘要 - 豆丁网 (docin.com)](https://www.docin.com/p-408636632.html?docfrom=rrela)

[搞定营销活动-谈一谈规则引擎在活动系统中的落地 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/371831214)

[网易考拉规则引擎平台架构设计与实践 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/47472836)

[复杂风控场景下，如何打造一款高效的规则引擎 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/140916822)

[B 站新一代 golang 规则引擎的设计与实现 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/364546754)

[智能风控决策引擎系统可落地实现方案（一）规则引擎实现 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/258093627)


[风控规则引擎构建及挑战 - 是咕咕鸡 - 博客园 (cnblogs.com)](https://www.cnblogs.com/gugujifly/p/17029925.html)

* 规则引擎背景
* 规则引擎技术选型原则
* 规则引擎术语
* 规则引擎的调优手段
